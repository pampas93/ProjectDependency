<!----------------------------------------------------------------------------
NoSqlDb.h Help file for Project #3
 Published 4 Apr 2017
 Abhijit Srikanth, CSE687 - Object Oriented Design, Spring 2017

 The below file is the webpage of the source code for NoSqlDb.h and holds links to its dependent files

 Note -Do not replace any markup characters with escape sequences
----------------------------------------------------------------------------->
<html>
<head>
<link rel = "stylesheet"type = "text/css"href = "../CodePublishHTML/myStyle.css" /></head>
<body class = "indent">
<script type="text/javascript" src="../CodePublishHTML/jquery-2.2.4.js"></script>
<script type="text/javascript" src="../CodePublishHTML/myJS.js"></script><h3>NoSqlDb.h</h3>
<hr><div class = "indent"><h4>Dependencies :</h4><ul><li> <a href="../CodePublishHTML/CppProperties.h.html">CppProperties.h</a> </li><li> <a href="../CodePublishHTML/GrammarHelpers.cpp.html">GrammarHelpers.cpp</a> </li><li> <a href="../CodePublishHTML/NoSqlDb.cpp.html">NoSqlDb.cpp</a> </li>
</ul></div><hr>
<pre>
#pragma once
/////////////////////////////////////////////////////////////////////
//  NoSqlDb.h - Key-value pair in Db, and corresponding functions  //
//  ver 1.0                                                        //
//                                                                 //
//  Language:      Visual C++ 2015, SP1                            //
//  Platform:      Dell Inspiron, Windows 8.1			           //
//  Application:   NoSql Database - CIS 687 Project 1              //
//  Author:        Abhijit Srikanth SUID:864888072			       //
/////////////////////////////////////////////////////////////////////
/*
Module Operations:
==================

This module defines a No SQL database class and an Element class.
* - NoSqlDb instance creates an underoreded map in the Heap memory
and itsfunctions is used to add, delete and modify the values,
persist into XML file and also persisting from the XML file.
* - The Element instance defines a the value part of the map and
holds the meta data, data for the record stored.

Both the above clases are Template classes,  that use one or more
unspecified types, defined by arguments in the template declaration.

Private Interface:
=================
NoSqlDb Class &gt; ---- &gt;

* std::string path;													- string to store path file for xml persisting
* std::unordered_map&lt;Key, Element&lt;Data&gt;&gt; dependencyStore;			- Database to store dependency analysis

shared_ptr&lt;AbstractXmlElement&gt; sptr		//Shared pointer used to create nodes in XML Document

Element Class &gt; ---- &gt;

dependencies														- Children of value in database

Build Process:
==============
Required files
- Cppproperties.h,
- XmlDocument.h, XmlElement.h,
- NoSqlDb.cpp

Build commands
- devenv CodeAnalyzerEx.sln

Maintenance History:
====================
ver 1.0 : 07 Mar 17
- first release
*/

 #include &lt;unordered_map&gt;
#include &lt;string&gt;
#include &lt;sstream&gt;
#include &lt;vector&gt;
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include "../CppProperties/CppProperties.h"
//#include "../XmlDocument/XmlDocument/XmlDocument.h"
//#include "../XmlDocument/XmlElement/XmlElement.h"

//using namespace XmlProcessing;

//using sptr = std::shared_ptr&lt;AbstractXmlElement&gt;;

namespace NoSQLDB
{
  using Key = std::string;
  using Children = std::vector&lt;Key&gt;;

  /////////////////////////////////////////////////////////////////////
  // Element class represents a data record in our NoSql database
  // - in our NoSql database that is just the value in a key/value pair
  // - it needs to store child data, something for you to implement
  //
  template&lt;typename Data&gt;
  class Element
  <div class="header">-  {</div><div class="content">
  public:

    Element() {}
	Property&lt;Children&gt; dependencies;          // Dependencies
    void saveChild(Key key);
    std::string show();

  </div>};

  //&lt;---------------------- Function to append child to perticular key -------------------&gt;
  template&lt;typename Data&gt;
  void Element&lt;Data&gt;::saveChild(Key key)
  <div class="header">-  {</div><div class="content">
	  Children temp = dependencies.getValue();
	  for (Key x : temp)
	  {
		  if (x == key)
			  return;
	  }
    dependencies.getValue().push_back(key);
	return;
  </div>}

  //&lt;---------------------- Function to Display the dependencies (children) -------------------&gt;
  template&lt;typename Data&gt;
  std::string Element&lt;Data&gt;::show()
  <div class="header">-  {</div><div class="content">
    std::ostringstream out;
    out.setf(std::ios::adjustfield, std::ios::left);
    Children dependencies_ = static_cast&lt;Children&gt;(dependencies);
    if (dependencies_.size() &gt; 0)
    {
		out &lt;&lt; "\n" &lt;&lt; std::setw(8) &lt;&lt; " Dependencies " &lt;&lt; " : \n";
      for (size_t i = 0; i &lt; dependencies_.size(); ++i)
      {
		  out &lt;&lt;"\t -&gt; " &lt;&lt; dependencies_[i] &lt;&lt; std::endl;
      }
	  out &lt;&lt; "\n\n" ;
    }
    return out.str();
  </div>}

  /////////////////////////////////////////////////////////////////////
  // NoSqlDb class is a key/value pair in-memory database
  //	- stores and retrieves elements
  //	- persists into and xml
  //	

  template&lt;typename Data&gt;
  class NoSqlDb
  <div class="header">-  {</div><div class="content">
  public:
    using Key = std::string;
    using Keys = std::vector&lt;Key&gt;;
	using xmlstring = std::string;

    Keys keys();
    bool hasKey(Key key);
    bool saveRecord(Key key, Element&lt;Data&gt; elem);
    bool saveValue(Key key, Element&lt;Data&gt; elem);
    bool removeRecord(Key key);
    Element&lt;Data&gt; value(Key key);
    size_t count();
	//void display();
	//std::string persistIntoXml(std::string path);

  private:
    using Item = std::pair&lt;Key, Element&lt;Data&gt;&gt;;
	std::string path;
    std::unordered_map&lt;Key, Element&lt;Data&gt;&gt; dependencyStore;
  </div>};

  //&lt;---------------------- Function to return keys of database -------------------&gt;
  template&lt;typename Data&gt;
  typename NoSqlDb&lt;Data&gt;::Keys NoSqlDb&lt;Data&gt;::keys()
  <div class="header">-  {</div><div class="content">
    Keys keys;
    for (Item item : dependencyStore)
    {
      keys.push_back(item.first);
    }
    return keys;
  </div>}

  //&lt;---------------------- Function to check if key present in database -------------------&gt;
  template&lt;typename Data&gt;
  bool NoSqlDb&lt;Data&gt;::hasKey(Key key)
  <div class="header">-  {</div><div class="content">
    if (dependencyStore.find(key) == dependencyStore.end())
      return false;
    return true;
  </div>}

  //&lt;---------------------- Function to save record in database -------------------&gt;
  template&lt;typename Data&gt;
  bool NoSqlDb&lt;Data&gt;::saveRecord(Key key, Element&lt;Data&gt; elem)
  <div class="header">-  {</div><div class="content">
    if (dependencyStore.find(key) != dependencyStore.end())
      return false;
	dependencyStore[key] = elem;
    return true;
  </div>}

  //&lt;---------------------- Function to remove record from database -------------------&gt;
  template&lt;typename Data&gt;
  bool NoSqlDb&lt;Data&gt;::removeRecord(Key key)
  <div class="header">-  {</div><div class="content">
	  if (dependencyStore.find(key) != store.end())
	  {
		  deleteInChildren(key);
		  dependencyStore.erase(key);
		  return true;
	  }
	  else
		  return false;
  </div>}

  //&lt;---------------------- Function to save or orverwrite value to perticular key in database -------------------&gt;
  template&lt;typename Data&gt;
  bool NoSqlDb&lt;Data&gt;::saveValue(Key key, Element&lt;Data&gt; elem)
  <div class="header">-  {</div><div class="content">
    /*if (dependencyStore.find(key) == dependencyStore.end())
      return false;
	dependencyStore[key] = elem;*/
	  dependencyStore[key] = elem;
    return true;
  </div>}

  //&lt;---------------------- Function to return value at that key -------------------&gt;
  template&lt;typename Data&gt;
  Element&lt;Data&gt; NoSqlDb&lt;Data&gt;::value(Key key)
  <div class="header">-  {</div><div class="content">
    if (dependencyStore.find(key) != dependencyStore.end())
      return dependencyStore[key];
    return Element&lt;Data&gt;();
  </div>}

  template&lt;typename Data&gt;
  size_t NoSqlDb&lt;Data&gt;::count()
  <div class="header">-  {</div><div class="content">
    return dependencyStore.size();
  </div>}

  //&lt;---------------------- Function to persist the database into xml -------------------&gt;
//  template&lt;typename Data&gt;
//  inline std::string NoSqlDb&lt;Data&gt;::persistIntoXml(std::string path)
//  {
//	  xmlstring xml;
//	  XmlDocument document;
//	  sptr pRoot = makeTaggedElement("Dependency_Table");
//	  document.docElement() = pRoot;
//	  Element&lt;Data&gt; temp;
//	  Keys setOfkeys = keys();
//	  for (Key k : setOfkeys)
//	  {
//		  sptr pKey = makeTaggedElement("Record");
//		  pRoot-&gt;addChild(pKey);
//		  sptr px = makeTaggedElement("Key");
//		  pKey-&gt;addChild(px);
//		  sptr pxkey = makeTextElement(k);
//		  px-&gt;addChild(pxkey);
//		  temp = value(k);
//		  Keys children = temp.dependencies;
//		  sptr pDp = makeTaggedElement("Dependencies");
//		  pKey-&gt;addChild(pDp);
//		  for (Key k : children)
//		  {
//			  sptr pChild = makeTaggedElement("File");
//			  pDp-&gt;addChild(pChild);
//			  sptr pFile = makeTextElement(k);
//			  pChild-&gt;addChild(pFile);
//		  }
//	  }
//	  xml = document.toString();
////	  path = "../XML_dependency.xml";
//	  try
//	  {
//		  std::ofstream sample(path);
//		  sample &lt;&lt; xml;
//		  sample.close();
//	  }
//	  catch (const std::exception& e)
//	  {
//		  std::cout &lt;&lt; e.what();
//	  }
//	  return xml;
//  }
}
</pre>
</body>
</html>