<!----------------------------------------------------------------------------
Window.cpp Help file for Project #3
 Published 4 Apr 2017
 Abhijit Srikanth, CSE687 - Object Oriented Design, Spring 2017

 The below file is the webpage of the source code for Window.cpp and holds links to its dependent files

 Note -Do not replace any markup characters with escape sequences
----------------------------------------------------------------------------->
<html>
<head>
<link rel = "stylesheet"type = "text/css"href = "../CodePublishHTML/myStyle.css" /></head>
<body class = "indent">
<script type="text/javascript" src="../CodePublishHTML/jquery-2.2.4.js"></script>
<script type="text/javascript" src="../CodePublishHTML/myJS.js"></script><h3>Window.cpp</h3>
<hr><div class = "indent"><h4>Dependencies :</h4><ul><li> <a href="../CodePublishHTML/Window.h.html">Window.h</a> </li><li> <a href="../CodePublishHTML/FileSystem.h.html">FileSystem.h</a> </li><li> <a href="../CodePublishHTML/Utilities.h.html">Utilities.h</a> </li><li> <a href="../CodePublishHTML/Utilities.h.html">Utilities.h</a> </li>
</ul></div><hr>
<pre>
/////////////////////////////////////////////////////////////////////
// Window.cpp - C++\CLI implementation of WPF Application          //
//            - Runs Code Static Analysis                          //
// ver 3.2                                                         //
//-----------------------------------------------------------------//
// Jim Fawcett (c) copyright 2016                                  //
// All rights granted provided this copyright notice is retained   //
//-----------------------------------------------------------------//
// Language:    C++, Visual Studio 2015                            //
// Platform:    Dell XPS 8900, Windows 10                          //
// Application: Code Analyzer for SMA and OOD, S2016               //
// Author:      Jim Fawcett, Syracuse University, CST 4-187        //
//              jfawcett@twcny.rr.com                              //
/////////////////////////////////////////////////////////////////////
/*
*  This note is here to show how to convert between console and window app.
*  ------------------------------------------------------------------------
*  To run as a Console Application - this is what you need for this project:
*  - Set Project Properties &gt; Linker &gt; System &gt; Subsytem to Console
*  - Uncomment int main(...) at bottom
*  - Comment out int _stdcall WinMain() at bottom
*  To run as a Windows Application - not very useful for this project:
*  - Set Project Properties &gt; Linker &gt; System &gt; Subsystem to Windows
*  - Comment out int main(...) at bottom
*  - Uncomment int _stdcall WinMain() at bottom
*/
#include "Window.h"
#include &lt;string&gt;

using namespace CppCliWindows;
using namespace System::Windows;
using namespace System::Windows::Data;
using namespace System::Globalization;
using namespace System::IO;
using namespace System::Reflection;
using namespace System::Diagnostics;

WPFCppCliDemo::WPFCppCliDemo()
<div class="header">-  {</div><div class="content">
  // set event handlers

  this-&gt;Loaded += 
    gcnew System::Windows::RoutedEventHandler(this, &WPFCppCliDemo::OnLoaded);
  this-&gt;Closing += 
    gcnew CancelEventHandler(this, &WPFCppCliDemo::Unloading);

  hExecutionTab-&gt;GotFocus += gcnew RoutedEventHandler(this, &CppCliWindows::WPFCppCliDemo::executionTabSelected);
  hSetupTab-&gt;GotFocus += gcnew RoutedEventHandler(this, &CppCliWindows::WPFCppCliDemo::setupTabSelected);
  hProcModeTab-&gt;GotFocus += gcnew RoutedEventHandler(this, &CppCliWindows::WPFCppCliDemo::procModeTabSelected);

  hExecuteViewStartButton_-&gt;Click += gcnew RoutedEventHandler(this, &WPFCppCliDemo::execute);
  hExecuteViewBrowseButton_-&gt;Click += gcnew RoutedEventHandler(this, &WPFCppCliDemo::browseForFolder);
  hSetupBrowseButton_-&gt;Click += gcnew RoutedEventHandler(this, &WPFCppCliDemo::browseForFolderEx);
  hSetupExecuteButton_-&gt;Click += gcnew RoutedEventHandler(this, &WPFCppCliDemo::execute);
  hExecuteViewTextBox_-&gt;LostFocus += gcnew RoutedEventHandler(this, &WPFCppCliDemo::OnExecuteViewTextChanged);
  hSetupViewTextBox_-&gt;LostFocus += gcnew RoutedEventHandler(this, &WPFCppCliDemo::OnSetupViewTextChanged);

  // set Window properties

  this-&gt;Title = "VisualCodeAnalyzer - Static Code Analysis";
  this-&gt;Width = 450;
  this-&gt;MinWidth = 450;
  this-&gt;Height = 320;
  this-&gt;MinHeight = 320;
  this-&gt;Name = "MainWindow";

  getUserSettings();

  // attach dock panel to Window

  this-&gt;Content = hDockPanel;
  hDockPanel-&gt;Children-&gt;Add(hStatusBar);
  hDockPanel-&gt;SetDock(hStatusBar, Dock::Bottom);
  hDockPanel-&gt;Children-&gt;Add(hGrid);

  // setup Window controls and views

  setUpTabControl();
  setUpStatusBar();
  createExecutionView();
  createSetupView();
  createDisplayModeView();

  hStatus-&gt;Text = "Browse to find analysis path or enter in textbox";
</div>}

WPFCppCliDemo::~WPFCppCliDemo()
<div class="header">-  {</div><div class="content">
  
</div>}
//----&lt; local helper function for getting user settings &gt;------------

bool stringToBool(String^ value)
<div class="header">-  {</div><div class="content">
  if (value == "true")
    return true;
  return false;
</div>}
//----&lt; retrieve user settings from last execution &gt;-----------------
/*
*  Look for user settings file in directory where GUI was started.
*/
void WPFCppCliDemo::getUserSettings()
<div class="header">-  {</div><div class="content">
  String^ settingsPath = Path::GetFullPath(Assembly::GetExecutingAssembly()-&gt;Location);
  settingsPath = Path::GetDirectoryName(settingsPath);
  if (!System::IO::Directory::Exists(settingsPath))
  {
    throw gcnew Exception("invalid settings path");
  }
  settingsPath += "\\UserSettings.txt";

  try
  {
    System::IO::StreamReader^ sr = gcnew System::IO::StreamReader(settingsPath);
    
    userSettings_.path = sr-&gt;ReadLine();
    userSettings_.h = stringToBool(sr-&gt;ReadLine());
    userSettings_.cpp = stringToBool(sr-&gt;ReadLine());
    userSettings_.cs = stringToBool(sr-&gt;ReadLine());
    userSettings_.upatt = stringToBool(sr-&gt;ReadLine());

    String^ commaSeperatedList = sr-&gt;ReadLine();
    array&lt;String^&gt;^ patts = commaSeperatedList-&gt;Split(',');
    for (int i = 0; i &lt; patts-&gt;Length; ++i)
      hUPattList_-&gt;Items-&gt;Add(patts[i]);

    userSettings_.cl = stringToBool(sr-&gt;ReadLine());

    userSettings_.metrics = stringToBool(sr-&gt;ReadLine());
    userSettings_.ast = stringToBool(sr-&gt;ReadLine());
    userSettings_.slocs = stringToBool(sr-&gt;ReadLine());
    userSettings_.rslt = stringToBool(sr-&gt;ReadLine());
    userSettings_.demo = stringToBool(sr-&gt;ReadLine());
    userSettings_.dbug = stringToBool(sr-&gt;ReadLine());
    userSettings_.logfile = stringToBool(sr-&gt;ReadLine());
    
    sr-&gt;Close();
  }
  catch (Exception^ /*e*/)
  {
    // use default values
    userSettings_.path = Environment::CurrentDirectory;
    userSettings_.h = true;
    userSettings_.cpp = true;
    userSettings_.cs = false;
    userSettings_.upatt = false;
    userSettings_.upattStrs = "";
    userSettings_.cl = false;
    userSettings_.metrics = true;
    userSettings_.ast = false;
    userSettings_.slocs = false;
    userSettings_.rslt = true;
    userSettings_.demo = false;
    userSettings_.dbug = false;
    userSettings_.logfile = true;
  }
  hExecuteViewTextBox_-&gt;Text = path_ = userSettings_.path;
  hSetupViewTextBox_-&gt;Text = path_;
</div>}
//----&lt; helper function for saving user settings &gt;-------------------

String^ boolToString(bool pred)
<div class="header">-  {</div><div class="content">
  if (pred)
    return "true";
  return "false";
</div>}
//----&lt; persist user settings to file &gt;------------------------------
/*
*  Look for user settings file in directory where GUI was started.
*/
void WPFCppCliDemo::saveUserSettings()
<div class="header">-  {</div><div class="content">
  String^ settingsPath = Path::GetFullPath(Assembly::GetExecutingAssembly()-&gt;Location);
  settingsPath = Path::GetDirectoryName(settingsPath);
  if (!System::IO::Directory::Exists(settingsPath))
  {
    throw gcnew Exception("invalid settings path path");
  }
  settingsPath += "\\UserSettings.txt";

  try
  {
    System::IO::StreamWriter^ sr = gcnew System::IO::StreamWriter(settingsPath);

    sr-&gt;WriteLine(path_);
    sr-&gt;WriteLine(boolToString((bool)hHdrs_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hImpls_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hCSharp_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hUPatt_-&gt;IsChecked));

    String^ commaSeparatedList;
    size_t count = hUPattList_-&gt;Items-&gt;Count;
    for (size_t i = 0; i &lt; count - 1; ++i)
      commaSeparatedList += hUPattList_-&gt;Items[i] + ",";
    commaSeparatedList += hUPattList_-&gt;Items[count - 1];
    sr-&gt;WriteLine(commaSeparatedList);

    sr-&gt;WriteLine(boolToString((bool)hClear_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hMetrics_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hAST_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hSlocs_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hRsltMode_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hDemoMode_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hDbugMode_-&gt;IsChecked));
    sr-&gt;WriteLine(boolToString((bool)hLogFileMode_-&gt;IsChecked));

    sr-&gt;Close();
  }
  catch (Exception^ e)
  {
    Console::Write("\n\n{0}\n", e-&gt;Message);
  }
</div>}
//----&lt; envent handlers for selecting Tabs &gt;-------------------------

void WPFCppCliDemo::setupTabSelected(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  this-&gt;Width = 600;
  this-&gt;Height = 500;
  hStatus-&gt;Text = "Use pattern settings and browse for path, or browse for files.";
</div>}

void WPFCppCliDemo::executionTabSelected(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  this-&gt;Width = 400;
  this-&gt;Height = 320;
  hStatus-&gt;Text = "Browse to find analysis path or enter in textbox, then start";
</div>}

void WPFCppCliDemo::procModeTabSelected(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  this-&gt;Width = 400;
  this-&gt;Height = 320;
  hStatus-&gt;Text = "Typically set Results Mode and LogFile Mode - use either Results or Demo or Debug";
</div>}
//----&lt; setup status bar controls &gt;----------------------------------

void WPFCppCliDemo::setUpStatusBar()
<div class="header">-  {</div><div class="content">
  hStatusBar-&gt;Items-&gt;Add(hStatusBarItem);
  //hStatus-&gt;FontWeight = FontWeights::Bold;
  hStatusBarItem-&gt;Content = hStatus;
  hStatusBar-&gt;Padding = Thickness(10, 2, 10, 2);
</div>}
//----&lt; setup application tab views &gt;--------------------------------

void WPFCppCliDemo::setUpTabControl()
<div class="header">-  {</div><div class="content">
  hGrid-&gt;Children-&gt;Add(hTabControl);
  hExecutionTab-&gt;Header = "Execution";
  hSetupTab-&gt;Header = "Applic Setup";
  hProcModeTab-&gt;Header = "Display Mode";
  hTabControl-&gt;Items-&gt;Add(hExecutionTab);
  hTabControl-&gt;Items-&gt;Add(hSetupTab);
  hTabControl-&gt;Items-&gt;Add(hProcModeTab);
</div>}
//----&lt; set properties of Execution View TextBox &gt;-------------------
/*
*  Sets TextBox properties and adds to Execution view
*/
void WPFCppCliDemo::setTextBlockProperties()
<div class="header">-  {</div><div class="content">
  RowDefinition^ hRow1Def = gcnew RowDefinition();
  hRow1Def-&gt;Height = GridLength(50);
  hExecutionGrid-&gt;RowDefinitions-&gt;Add(hRow1Def);
  hExecutionGrid-&gt;Margin = Thickness(40);
  Border^ hBorder1 = gcnew Border();
  hBorder1-&gt;BorderThickness = Thickness(1);
  hBorder1-&gt;BorderBrush = Brushes::Black;
  hBorder1-&gt;Height = 25;
  hBorder1-&gt;Child = hExecuteViewTextBox_;
  hExecuteViewTextBox_-&gt;Padding = Thickness(2);
  hExecuteViewTextBox_-&gt;Text = "";
  hExecuteViewTextBox_-&gt;FontFamily = gcnew Windows::Media::FontFamily("Tahoma");
  hExecuteViewTextBox_-&gt;FontWeight = FontWeights::Normal;
  hExecuteViewTextBox_-&gt;FontSize = 14;
  hExecutionGrid-&gt;SetRow(hBorder1, 0);
  hExecutionGrid-&gt;Children-&gt;Add(hBorder1);
</div>}
//----&lt; set properties of Execution View Buttons &gt;-------------------
/*
*  Sets Buttons properties and adds them to Execution view
*/
void WPFCppCliDemo::setButtonsProperties()
<div class="header">-  {</div><div class="content">
  RowDefinition^ hRow2Def = gcnew RowDefinition();
  hRow2Def-&gt;Height = GridLength(75);
  hExecutionGrid-&gt;RowDefinitions-&gt;Add(hRow2Def);
  hExecuteViewBrowseButton_-&gt;Content = "Browse";
  hExecuteViewBrowseButton_-&gt;Width = 90;
  hExecuteViewBrowseButton_-&gt;Height = 20;
  hExecuteViewStartButton_-&gt;Content = "Start Analysis";
  hExecuteViewStartButton_-&gt;Width = 90;
  hExecuteViewStartButton_-&gt;Height = 20;
  hExecuteViewStartButton_-&gt;IsEnabled = true;
  hStackPanel1-&gt;Children-&gt;Add(hExecuteViewBrowseButton_);
  Label^ hHorizontalSpacer = gcnew Label();
  hHorizontalSpacer-&gt;Width = 40;
  hStackPanel1-&gt;Children-&gt;Add(hHorizontalSpacer);
  hStackPanel1-&gt;Children-&gt;Add(hExecuteViewStartButton_);
  hStackPanel1-&gt;Orientation = Orientation::Horizontal;
  hStackPanel1-&gt;HorizontalAlignment = System::Windows::HorizontalAlignment::Center;
  hExecutionGrid-&gt;SetRow(hStackPanel1, 1);
  hExecutionGrid-&gt;Children-&gt;Add(hStackPanel1);
</div>}
//----&lt; assemble Execution view &gt;------------------------------------

void WPFCppCliDemo::createExecutionView()
<div class="header">-  {</div><div class="content">
  Border^ hExecutionBorder = gcnew Border();
  hExecutionBorder-&gt;BorderThickness = Thickness(1);
  hExecutionBorder-&gt;Margin = Thickness(15);
  hExecutionBorder-&gt;BorderBrush = Brushes::LightGray;
  hExecutionBorder-&gt;Child = hExecutionGrid;
  hExecutionTab-&gt;Content = hExecutionBorder;

  setTextBlockProperties();
  setButtonsProperties();
</div>}
//----&lt; helper class for binding ListBox in SetupView &gt;--------------

ref class HeightConverter : IValueConverter
<div class="header">-  {</div><div class="content">
public:
  virtual Object^ Convert(Object^ value, Type^ typeTarget, Object^ param, CultureInfo^ culture)
  <div class="header">-  {</div><div class="content">
    return (Object^)((Double)value - 420);
  </div>}
  virtual Object^ ConvertBack(Object^ value, Type^ typeTarget, Object^ param, CultureInfo^ culture)
  <div class="header">-  {</div><div class="content">
    return (Object^)((Double)value + 420);
  </div>}
</div>};
//----&lt; setup grid for Setup View &gt;----------------------------------

void WPFCppCliDemo::setUpGrid()
<div class="header">-  {</div><div class="content">
  hSetupGrid-&gt;Margin = Thickness(10);
  hSetupTab-&gt;Content = hSetupGrid;

  ColumnDefinition^ hCol1Def = gcnew ColumnDefinition();
  hCol1Def-&gt;Name = "ColumnLeft";
  hSetupGrid-&gt;ColumnDefinitions-&gt;Add(hCol1Def);
  ColumnDefinition^ hCol2Def = gcnew ColumnDefinition();
  hCol2Def-&gt;Name = "Column2";
  hCol2Def-&gt;Width = GridLength(250, GridUnitType::Pixel);
  hSetupGrid-&gt;ColumnDefinitions-&gt;Add(hCol2Def);
</div>}
//----&lt; setup file list binding of height to window height &gt;---------

void WPFCppCliDemo::setUpBinding()
<div class="header">-  {</div><div class="content">
  // bind ListBox height to Window height minus offset
  // defined by HeightConverter

  Binding^ bnd = gcnew Binding("Value");
  bnd-&gt;Source = this;
  bnd-&gt;Converter = gcnew HeightConverter();
  bnd-&gt;Path = gcnew PropertyPath(hUPattList_-&gt;ActualHeightProperty);
  bnd-&gt;Mode = BindingMode::OneWay;
  bnd-&gt;UpdateSourceTrigger = UpdateSourceTrigger::PropertyChanged;
  BindingOperations::SetBinding(hUPattList_, ListBox::HeightProperty, bnd);
</div>}
//----&lt; initialize setup view buttons &gt;------------------------------

void WPFCppCliDemo::setUpSearchButtons()
<div class="header">-  {</div><div class="content">
  hSetupBrowseButton_-&gt;Content = "Browse";
  hSetupBrowseButton_-&gt;Height = 20;
  hSetupBrowseButton_-&gt;Width = 90;

  hSetupExecuteButton_-&gt;Content = "Start Analysis";
  hSetupExecuteButton_-&gt;Height = 20;
  hSetupExecuteButton_-&gt;Width = 90;

  Label^ hHorizSpacer3 = gcnew Label();
  hHorizSpacer3-&gt;Width = 16;

  Label^ hHorizSpacer4 = gcnew Label();
  hHorizSpacer3-&gt;Width = 16;

  hButtonsDocker_-&gt;SetValue(DockPanel::HorizontalAlignmentProperty, System::Windows::HorizontalAlignment::Left);
  hButtonsDocker_-&gt;Children-&gt;Add(hHorizSpacer3);
  hButtonsDocker_-&gt;Children-&gt;Add(hSetupBrowseButton_);
  hButtonsDocker_-&gt;Children-&gt;Add(hHorizSpacer4);
  hButtonsDocker_-&gt;Children-&gt;Add(hSetupExecuteButton_);
</div>}
//----&lt; setup file list &gt;--------------------------------------------

void WPFCppCliDemo::setupFileList()
<div class="header">-  {</div><div class="content">
  hUPatt_-&gt;IsChecked = userSettings_.upatt;
  hUPatt_-&gt;SetValue(DockPanel::HorizontalAlignmentProperty, System::Windows::HorizontalAlignment::Left);
  hUPattDock_-&gt;Children-&gt;Add(hUPatt_);
  hUPattList_-&gt;Height = 70;
  hUPattDock_-&gt;Children-&gt;Add(hUPattList_);

  hClearLabel_-&gt;Content = "clear file list on browse";
  hClear_-&gt;IsChecked = userSettings_.cl;
  hClearStack_ = gcnew StackPanel();
  hClearStack_-&gt;Orientation = Orientation::Horizontal;
  hClearStack_-&gt;Children-&gt;Add(hClear_);
  hClearStack_-&gt;Children-&gt;Add(hClearLabel_);
</div>}
//----&lt; setup path Grid panel &gt;--------------------------------------

void WPFCppCliDemo::setUpPathPanel()
<div class="header">-  {</div><div class="content">
  hPathLabel_-&gt;Content = "analysis path";
  hSetupViewTextBox_-&gt;Padding = Thickness(2);
  hSetupViewTextBox_-&gt;FontFamily = gcnew Windows::Media::FontFamily("Tahoma");
  hSetupViewTextBox_-&gt;FontWeight = FontWeights::Normal;
  hSetupViewTextBox_-&gt;FontSize = 14;
  hPathPanel_-&gt;Children-&gt;Add(hSetupViewTextBox_);
</div>}
//----&lt; setup file selection for search panel &gt;----------------------

void WPFCppCliDemo::setupFileSearch()
<div class="header">-  {</div><div class="content">
  setupFileList();
  setUpSearchButtons();
  setUpPathPanel();

  Label^ hVerticalSpacer1 = gcnew Label();
  hVerticalSpacer1-&gt;Content = "";
  hVerticalSpacer1-&gt;Height = 10;

  Label^ hVerticalSpacer2 = gcnew Label();
  hVerticalSpacer2-&gt;Height = 10;

  Label^ hVerticalSpacer3 = gcnew Label();
  hVerticalSpacer3-&gt;Height = 10;

  StackPanel^ hStackPanelLeft = gcnew StackPanel();
  hStackPanelLeft-&gt;Children-&gt;Add(hPattLabel_);
  hStackPanelLeft-&gt;Children-&gt;Add(hHdrsStack_);
  hStackPanelLeft-&gt;Children-&gt;Add(hImplsStack_);
  hStackPanelLeft-&gt;Children-&gt;Add(hCSharpStack_);
  hStackPanelLeft-&gt;Children-&gt;Add(hUPattDock_);
  hStackPanelLeft-&gt;Children-&gt;Add(hVerticalSpacer1);
  hStackPanelLeft-&gt;Children-&gt;Add(hClearStack_);
  hStackPanelLeft-&gt;Children-&gt;Add(hVerticalSpacer2);
  hStackPanelLeft-&gt;Children-&gt;Add(hButtonsDocker_);
  hStackPanelLeft-&gt;Children-&gt;Add(hVerticalSpacer3);
  hStackPanelLeft-&gt;Children-&gt;Add(hPathLabel_);
  hStackPanelLeft-&gt;Children-&gt;Add(hPathPanel_);
  hStackPanelLeft-&gt;Orientation = Orientation::Vertical;
  hStackPanelLeft-&gt;Margin = Thickness(10);
  hStackPanelLeft-&gt;Name = "StackPanelLeft";

  Border^ hBorderLeft = gcnew Border();
  hBorderLeft-&gt;Child = hStackPanelLeft;
  hBorderLeft-&gt;BorderBrush = Brushes::LightGray;
  hBorderLeft-&gt;BorderThickness = Thickness(1);
  hBorderLeft-&gt;MinWidth = 200;
  hBorderLeft-&gt;Margin = Thickness(5);

  hSetupGrid-&gt;SetColumn(hBorderLeft, 0);
  hSetupGrid-&gt;Children-&gt;Add(hBorderLeft);

  setUpBinding();
</div>}
//----&lt; setup patterns stacks &gt;--------------------------------------

void WPFCppCliDemo::setUpPatternsStacks()
<div class="header">-  {</div><div class="content">
  hPattLabel_-&gt;Content = "Search Parameters";
  hPattLabel_-&gt;FontSize = 16;
  hPattLabel_-&gt;Margin = Thickness(10);

  hHdrsLabel_-&gt;Content = "*.h";
  hHdrs_-&gt;IsChecked = userSettings_.h;
  hHdrsStack_-&gt;Orientation = Orientation::Horizontal;
  hHdrsStack_-&gt;Children-&gt;Add(hHdrs_);
  hHdrsStack_-&gt;Children-&gt;Add(hHdrsLabel_);

  hImplsLabel_-&gt;Content = "*.cpp";
  hImpls_-&gt;IsChecked = userSettings_.cpp;
  hImplsStack_-&gt;Orientation = Orientation::Horizontal;
  hImplsStack_-&gt;Children-&gt;Add(hImpls_);
  hImplsStack_-&gt;Children-&gt;Add(hImplsLabel_);

  hCSharpLabel_-&gt;Content = "*.cs";
  hCSharp_-&gt;IsChecked = userSettings_.cs;
  hCSharpStack_-&gt;Orientation = Orientation::Horizontal;
  hCSharpStack_-&gt;Children-&gt;Add(hCSharp_);
  hCSharpStack_-&gt;Children-&gt;Add(hCSharpLabel_);
</div>}
//----&lt; setup search panel for Setup View &gt;--------------------------

void WPFCppCliDemo::setUpSearchPanel()
<div class="header">-  {</div><div class="content">
  setUpPatternsStacks();
  setupFileSearch();
</div>}
//----&lt; setup Detailed Displays Panel for Setup View &gt;---------------

void WPFCppCliDemo::setUpDisplaysPanel()
<div class="header">-  {</div><div class="content">
  Label^ hDisplaysLabel = gcnew Label();
  hDisplaysLabel-&gt;Content = "Detailed Displays";
  hDisplaysLabel-&gt;FontSize = 16;
  hDisplaysLabel-&gt;Margin = Thickness(10);

  hMetricsLabel_-&gt;Content = "Metrics display";
  hMetrics_-&gt;IsChecked = userSettings_.metrics;
  StackPanel^ hMetricsStack = gcnew StackPanel();
  hMetricsStack-&gt;Orientation = Orientation::Horizontal;
  hMetricsStack-&gt;Children-&gt;Add(hMetrics_);
  hMetricsStack-&gt;Children-&gt;Add(hMetricsLabel_);

  hASTLabel_-&gt;Content = "AST display";
  hAST_-&gt;IsChecked = userSettings_.ast;
  StackPanel^ hASTStack = gcnew StackPanel();
  hASTStack-&gt;Orientation = Orientation::Horizontal;
  hASTStack-&gt;Children-&gt;Add(hAST_);
  hASTStack-&gt;Children-&gt;Add(hASTLabel_);

  hSlocsLabel_-&gt;Content = "Slocs display";
  hSlocs_-&gt;IsChecked = userSettings_.slocs;
  StackPanel^ hSlocsStack = gcnew StackPanel();
  hSlocsStack-&gt;Orientation = Orientation::Horizontal;
  hSlocsStack-&gt;Children-&gt;Add(hSlocs_);
  hSlocsStack-&gt;Children-&gt;Add(hSlocsLabel_);

  Label^ hDisplaysCommentLabel = gcnew Label();
  hDisplaysCommentLabel-&gt;Content = "Metric Summary always shown";
  hDisplaysCommentLabel-&gt;Margin = Thickness(5);
  hDisplaysCommentLabel-&gt;HorizontalAlignment = System::Windows::HorizontalAlignment::Left;

  StackPanel^ hStackPanelRight = gcnew StackPanel();
  hStackPanelRight-&gt;Children-&gt;Add(hDisplaysLabel);
  hStackPanelRight-&gt;Children-&gt;Add(hMetricsStack);
  hStackPanelRight-&gt;Children-&gt;Add(hASTStack);
  hStackPanelRight-&gt;Children-&gt;Add(hSlocsStack);
  hStackPanelRight-&gt;Children-&gt;Add(hDisplaysCommentLabel);

  hStackPanelRight-&gt;Orientation = Orientation::Vertical;
  hStackPanelRight-&gt;Margin = Thickness(10);

  Border^ hBorderRight = gcnew Border();
  hBorderRight-&gt;Child = hStackPanelRight;
  hBorderRight-&gt;BorderBrush = Brushes::LightGray;
  hBorderRight-&gt;BorderThickness = Thickness(1);
  hBorderRight-&gt;MinWidth = 200;
  hBorderRight-&gt;Margin = Thickness(5);
  //hBorderRight-&gt;Width = 200;

  hSetupGrid-&gt;SetColumn(hBorderRight, 1);
  hSetupGrid-&gt;Children-&gt;Add(hBorderRight);
</div>}

//----&lt; assemble Setup view &gt;----------------------------------------

void WPFCppCliDemo::createSetupView()
<div class="header">-  {</div><div class="content">
  setUpGrid();
  setUpSearchPanel();
  setUpDisplaysPanel();
</div>}
//----&lt; assemble Display Mode view &gt;---------------------------------

void WPFCppCliDemo::createDisplayModeView()
<div class="header">-  {</div><div class="content">
  Border^ hProcBorder = gcnew Border();
  hProcBorder-&gt;BorderThickness = Thickness(1);
  hProcBorder-&gt;Margin = Thickness(15);
  hProcBorder-&gt;BorderBrush = Brushes::LightGray;
  hProcBorder-&gt;Child = hModeGrid;
  hProcModeTab-&gt;Content = hProcBorder;

  ColumnDefinition^ hCol1Def = gcnew ColumnDefinition();
  hModeGrid-&gt;ColumnDefinitions-&gt;Add(hCol1Def);

  Label^ hRsltModeLabel = gcnew Label();
  hRsltModeLabel-&gt;Content = "Results mode";
  hRsltMode_-&gt;IsChecked = userSettings_.rslt;
  StackPanel^ hRsltStack = gcnew StackPanel();
  hRsltStack-&gt;Orientation = Orientation::Horizontal;
  hRsltStack-&gt;Children-&gt;Add(hRsltMode_);
  hRsltStack-&gt;Children-&gt;Add(hRsltModeLabel);

  Label^ hDemoModeLabel = gcnew Label();
  hDemoModeLabel-&gt;Content = "Demo mode";
  hDemoMode_-&gt;IsChecked = userSettings_.demo;
  StackPanel^ hDemoStack = gcnew StackPanel();
  hDemoStack-&gt;Orientation = Orientation::Horizontal;
  hDemoStack-&gt;Children-&gt;Add(hDemoMode_);
  hDemoStack-&gt;Children-&gt;Add(hDemoModeLabel);

  Label^ hDbugModeLabel = gcnew Label();
  hDbugModeLabel-&gt;Content = "DBug mode";
  hDbugMode_-&gt;IsChecked = userSettings_.dbug;
  StackPanel^ hDbugStack = gcnew StackPanel();
  hDbugStack-&gt;Orientation = Orientation::Horizontal;
  hDbugStack-&gt;Children-&gt;Add(hDbugMode_);
  hDbugStack-&gt;Children-&gt;Add(hDbugModeLabel);

  Label^ hLogFileModeLabel = gcnew Label();
  hLogFileModeLabel-&gt;Content = "Log file mode";
  hLogFileMode_-&gt;IsChecked = userSettings_.logfile;
  StackPanel^ hLogFileStack = gcnew StackPanel();
  hLogFileStack-&gt;Orientation = Orientation::Horizontal;
  hLogFileStack-&gt;Children-&gt;Add(hLogFileMode_);
  hLogFileStack-&gt;Children-&gt;Add(hLogFileModeLabel);

  StackPanel^ hStackPanel = gcnew StackPanel();
  hStackPanel-&gt;Children-&gt;Add(hRsltStack);
  hStackPanel-&gt;Children-&gt;Add(hDemoStack);
  hStackPanel-&gt;Children-&gt;Add(hDbugStack);
  hStackPanel-&gt;Children-&gt;Add(hLogFileStack);
  hStackPanel-&gt;Orientation = Orientation::Vertical;
  hStackPanel-&gt;Margin = Thickness(30);

  hModeGrid-&gt;SetColumn(hStackPanel, 0);
  hModeGrid-&gt;Children-&gt;Add(hStackPanel);
</div>}
//----&lt; set up command line for Analyzer.exe &gt;-----------------------

void WPFCppCliDemo::setCmdLineArgs()
<div class="header">-  {</div><div class="content">
  cmdLine_ = "\"" + path_ + "\"";
  if (hHdrs_-&gt;IsChecked)
    cmdLine_ += " *.h";
  if (hImpls_-&gt;IsChecked)
    cmdLine_ += " *.cpp";
  if (hCSharp_-&gt;IsChecked)
    cmdLine_ += " *.cs";
  if (hUPatt_-&gt;IsChecked)
  {
    for (size_t i = 0; i &lt; hUPattList_-&gt;Items-&gt;Count; ++i)
    {
      if(hUPattList_-&gt;Items[i]-&gt;ToString() != "FolderSelection")
        cmdLine_ += " " + hUPattList_-&gt;Items[i];
    }
  }
  if (hSlocs_-&gt;IsChecked)
    cmdLine_ += " /s";
  if (hAST_-&gt;IsChecked)
    cmdLine_ += " /a";
  if (hMetrics_-&gt;IsChecked)
    cmdLine_ += " /m";
  if (hRsltMode_-&gt;IsChecked)
    cmdLine_ += " /r";
  if (hDemoMode_-&gt;IsChecked)
    cmdLine_ += " /d";
  if (hDbugMode_-&gt;IsChecked)
    cmdLine_ += " /b";
  if (hLogFileMode_-&gt;IsChecked)
    cmdLine_ += " /f";
</div>}
//----&lt; execute Analyzer.exe as a separate process &gt;----------------0

void WPFCppCliDemo::doExecute()
<div class="header">-  {</div><div class="content">
  Console::Clear();
  ProcessStartInfo^ psi = gcnew ProcessStartInfo();
  psi-&gt;UseShellExecute = false;
  /*
  *  Look for Analyzer executable in directory where GUI was started.
  */
  String^ analyzerPath = Path::GetFullPath(Assembly::GetExecutingAssembly()-&gt;Location);
  analyzerPath = Path::GetDirectoryName(analyzerPath);
  if (!System::IO::Directory::Exists(analyzerPath))
  {
    throw gcnew Exception("invalid analyzer path");
  }
  analyzerPath += "\\CodeAnalyzer.exe";
  try {
    analyzerPath = System::IO::Path::GetFullPath(analyzerPath);
    psi-&gt;FileName = analyzerPath;
    setCmdLineArgs();
    psi-&gt;Arguments = cmdLine_;
    Process^ p = Process::Start(psi);
  }
  catch (Exception^ ex)
  {
    // we get here if file spec is invalid

    Console::Write("\n{0} = {1}", ex-&gt;Message, analyzerPath);
    Console::Write("\n{0}\n", "try rebuilding CodeAnalyzer");
  }
  saveUserSettings();
</div>}
//----&lt; event handler for Start Analysis Button &gt;--------------------

void WPFCppCliDemo::execute(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  setCmdLineArgs();
  doExecute();
</div>}
//----&lt; event handler for Browse Button &gt;----------------------------
/*
*  - Used in both Execution and Setup Views.
*  - Uses an OpenFileDialog so we can select either files or folders.
*  - Always clears file list on browse.
*/
void WPFCppCliDemo::browseForFolder(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  String^ defaultFileName = "FolderSelection";
  System::Windows::Forms::DialogResult result;

  hOpenFileDialog-&gt;CheckPathExists = true;
  hOpenFileDialog-&gt;CheckFileExists = false;
  hOpenFileDialog-&gt;ShowReadOnly = false;
  hOpenFileDialog-&gt;ReadOnlyChecked = true;
  hOpenFileDialog-&gt;ValidateNames = false;
  hOpenFileDialog-&gt;Multiselect = true;
  hOpenFileDialog-&gt;FileName = defaultFileName;
  hOpenFileDialog-&gt;InitialDirectory = hExecuteViewTextBox_-&gt;Text;
  result = hOpenFileDialog-&gt;ShowDialog();

  if (result == System::Windows::Forms::DialogResult::OK)
  {
    hUPattList_-&gt;Items-&gt;Clear();
    array&lt;String^&gt;^ fileNames = hOpenFileDialog-&gt;FileNames;
    String^ path = System::IO::Path::GetDirectoryName(fileNames[0]);

    for (int i = 0; i &lt; fileNames-&gt;Length; ++i)
    {
      String^ name = System::IO::Path::GetFileName(fileNames[i]);
      hUPattList_-&gt;Items-&gt;Add(name);
    }
    hExecuteViewTextBox_-&gt;Text = path;
    hSetupViewTextBox_-&gt;Text = path;
    path_ = path;
    hExecuteViewStartButton_-&gt;IsEnabled = true;
    if (hUPattList_-&gt;Items-&gt;Count == 0)
      return;

    // change settings depending on file or folder selection

    String^ debug = hUPattList_-&gt;Items[0]-&gt;ToString();

    if (hUPattList_-&gt;Items[0]-&gt;ToString() == defaultFileName)
    {
      hHdrs_-&gt;IsChecked = true;
      hImpls_-&gt;IsChecked = true;
      hCSharp_-&gt;IsChecked = true;
      hUPatt_-&gt;IsChecked = false;
    }
    else
    {
      hHdrs_-&gt;IsChecked = false;
      hImpls_-&gt;IsChecked = false;
      hCSharp_-&gt;IsChecked = false;
      hUPatt_-&gt;IsChecked = true;
    }
  }
</div>}
//----&lt; event handler for Setup Browse Button &gt;----------------------
/*
*  - Used in both Execution and Setup Views.
*  - Uses an OpenFileDialog so we can select either files or folders.
*  - Clears file list only if clear CheckBox on Setup View is checked.
*/
void WPFCppCliDemo::browseForFolderEx(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  String^ defaultFileName = "FolderSelection";
  System::Windows::Forms::DialogResult result;

  hOpenFileDialog-&gt;CheckPathExists = true;
  hOpenFileDialog-&gt;CheckFileExists = false;
  hOpenFileDialog-&gt;ShowReadOnly = false;
  hOpenFileDialog-&gt;ReadOnlyChecked = true;
  hOpenFileDialog-&gt;ValidateNames = false;
  hOpenFileDialog-&gt;Multiselect = true;
  hOpenFileDialog-&gt;FileName = defaultFileName;
  hOpenFileDialog-&gt;InitialDirectory = hExecuteViewTextBox_-&gt;Text;
  result = hOpenFileDialog-&gt;ShowDialog();

  if (result == System::Windows::Forms::DialogResult::OK)
  {
    if(hClear_-&gt;IsChecked)
      hUPattList_-&gt;Items-&gt;Clear();
    array&lt;String^&gt;^ fileNames = hOpenFileDialog-&gt;FileNames;
    String^ path = System::IO::Path::GetDirectoryName(fileNames[0]);

    for (int i = 0; i &lt; fileNames-&gt;Length; ++i)
    {
      String^ name = System::IO::Path::GetFileName(fileNames[i]);
      hUPattList_-&gt;Items-&gt;Add(name);
    }
    if (hClear_-&gt;IsChecked)
    {
      hExecuteViewTextBox_-&gt;Text = path;
      hSetupViewTextBox_-&gt;Text = path;
      path_ = path;
    }
    hExecuteViewStartButton_-&gt;IsEnabled = true;

    // change settings depending on file or folder selection

    String^ debug = hUPattList_-&gt;Items[0]-&gt;ToString();

    if (hClear_-&gt;IsChecked && hUPattList_-&gt;Items[0]-&gt;ToString() == defaultFileName)
    {
      hHdrs_-&gt;IsChecked = true;
      hImpls_-&gt;IsChecked = true;
      hCSharp_-&gt;IsChecked = true;
      hUPatt_-&gt;IsChecked = false;
    }
    else
    {
      hHdrs_-&gt;IsChecked = false;
      hImpls_-&gt;IsChecked = false;
      hCSharp_-&gt;IsChecked = false;
      hUPatt_-&gt;IsChecked = true;
    }
  }
</div>}
//----&lt; event handler for Window Loaded event &gt;----------------------

void WPFCppCliDemo::OnLoaded(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  hExecuteViewTextBox_-&gt;Text = path_;
  hSetupViewTextBox_-&gt;Text = path_;
</div>}
//----&lt; event handler for Window unloading event &gt;-------------------

void WPFCppCliDemo::Unloading(Object^ sender, System::ComponentModel::CancelEventArgs^ args)
<div class="header">-  {</div><div class="content">
  saveUserSettings();
</div>}
//----&lt; event handler for manual changes to path in textbox &gt;--------

void WPFCppCliDemo::OnExecuteViewTextChanged(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  path_ = hExecuteViewTextBox_-&gt;Text;
  hSetupViewTextBox_-&gt;Text = path_;
</div>}
//----&lt; event handler for manual changes to path in textbox &gt;--------

void WPFCppCliDemo::OnSetupViewTextChanged(Object^ sender, RoutedEventArgs^ args)
<div class="header">-  {</div><div class="content">
  path_ = hSetupViewTextBox_-&gt;Text;
  hExecuteViewTextBox_-&gt;Text = path_;
</div>}

/////////////////////////////////////////////////////////////////////
// Not used now:
//
//String^ WPFCppCliDemo::toSystemString(std::string& str)
//{
//  StringBuilder^ pStr = gcnew StringBuilder();
//  for (size_t i = 0; i &lt; str.size(); ++i)
//    pStr-&gt;Append((Char)str[i]);
//  return pStr-&gt;ToString();
//}
//
//std::string WPFCppCliDemo::toStdString(String^ pStr)
//{
//  std::string dst;
//  for (int i = 0; i &lt; pStr-&gt;Length; ++i)
//    dst += (char)pStr[i];
//  return dst;
//}
//
// Note:
// The comments, below, are placed here to show you how to convert to a
// Windows application.  You don't want to do that for this project, but
// it is useful to know how to do this.

[STAThread]
//int _stdcall WinMain()
int main(array&lt;System::String^&gt;^ args)
<div class="header">-  {</div><div class="content">
  //MSG msg;
  //Console::WriteLine(L"\n Starting WPFCppCliDemo");
  //while ((GetMessage(&msg, NULL, 0, 0)) != 0)
  //{
  //  TranslateMessage(&msg);
  //  DispatchMessage(&msg);
  //}

  Application^ app = gcnew Application();
  app-&gt;Run(gcnew WPFCppCliDemo());
  Console::WriteLine(L"\n\n");
}
</pre>
</body>
</html>